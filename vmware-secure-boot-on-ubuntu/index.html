<!doctype html><html lang=en><head><script integrity=sha384-4c2QSBFoIWtWdjHBS/+xfcnPBuCo/9yN1c218v1U+4D9Y+AjEB+sT628EGjjbVtE src=https://nopointers.work/js/theme_light.min.js></script><link href="https://nopointers.work/abridge.css?h=c25b41b0b177d49c6707" rel=stylesheet><meta charset=utf-8><meta content="ie=edge" http-equiv=x-ua-compatible><meta content="width=device-width,initial-scale=1" name=viewport><meta content=https://nopointers.work name=base><meta content=True name=HandheldFriendly><meta content=yes name=mobile-web-app-capable><meta content=yes name=apple-mobile-web-app-capable><meta content=default name=apple-mobile-web-app-status-bar-style><meta content=#333333 name=theme-color><meta content=#333333 name=msapplication-TileColor><link href=https://nopointers.work/manifest.min.json rel=manifest><link color=#ff9900 href=https://nopointers.work/safari-pinned-tab.svg rel=mask-icon><link href=https://nopointers.work/favicon.svg rel=icon type=image/svg+xml><link href=https://nopointers.work/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://nopointers.work/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://nopointers.work/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link title="nopointers.work.blog Atom/RSS Feed" href=https://nopointers.work/atom.xml rel=alternate type=application/atom+xml><meta content="index, follow" name=robots><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=googlebot><meta content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" name=bingbot><title>How to enable UEFI and secure boot when running Linux in VmWare Workstation Pro | nopointers.work.blog</title><meta content="Balázs Róbert Börcsök" name=author><meta content=nopointers.work.blog name=copyright><meta content="Personal site of Balázs Róbert Börcsök" name=description><link href=https://nopointers.work/vmware-secure-boot-on-ubuntu/ rel=canonical><meta content="portfolio, GitHub, GH pages, Zola, Semantic Html, Fast, lightweight" name=keywords><meta content="Your Google Site verification code." name=google-site-verification><meta content="Your Bing Site verification code." name=msvalidate.01><meta content=https://nopointers.work/vmware-secure-boot-on-ubuntu/ property=og:url><meta content=https://nopointers.work/vmware-secure-boot-on-ubuntu/ name=twitter:url><meta content="Personal site of Balázs Róbert Börcsök" property=og:description><meta content="Personal site of Balázs Róbert Börcsök" name=twitter:description><meta content="How to enable UEFI and secure boot when running Linux in VmWare Workstation Pro | nopointers.work.blog" property=og:title><meta content="How to enable UEFI and secure boot when running Linux in VmWare Workstation Pro | nopointers.work.blog" name=twitter:title><meta content=summary_large_image name=twitter:card><meta content=https://nopointers.work/banner.png name=twitter:image><meta content=https://nopointers.work/banner.png property=og:image><meta content=nopointers.work.blog property=og:site_name><meta content=en_US property=og:locale><meta content=website property=og:type><meta content=2024-08-01 property=og:updated_time><meta content=@your-user-name name=twitter:site><meta content=@your-user-name name=twitter:creator><script src="https://nopointers.work/js/abridge.min.js?h=1a12cf684ae4ed40434f" defer integrity=sha384-ZsreuwU2rKTp7gC4bTf5sYz+3AjMym99XDa/B5wa08fCzLVVX+NDaTsTeyLXseDG></script><noscript><link href=https://nopointers.work/nojs.css rel=stylesheet></noscript><body><header><nav><div><h1><a href=https://nopointers.work title=nopointers.work.blog>nopointers.work.blog</a></h1></div><div><div><ul><li><a class=s110 href=https://nopointers.work/about/> About </a><li><a class=s110 href=https://nopointers.work/archive/> Posts </a><li><a class=s110 href=https://nopointers.work/tags/> Tags </a><li><i class="js svgs adjust" id=mode type=reset></i></ul></div><div><div><form autocomplete=off class=js id=searchbox name=goSearch><div class=searchd><input id=searchinput placeholder=Search title=Search><button class="svgs search" title=Search></button></div><div class=results><div id=suggestions></div></div></form></div></div></div></nav><div class=desc>Personal site of Balázs Róbert Börcsök</div><hr></header><main><article><h1><a href=https://nopointers.work/vmware-secure-boot-on-ubuntu/>How to enable UEFI and secure boot when running Linux in VmWare Workstation Pro</a></h1><span class=s95> Balázs Róbert Börcsök <span class=rpad></span> August 01, 2024 <span class=rpad></span>Updated: August 01, 2024 <span class=rpad></span> #<a href=https://nopointers.work/tags/linux/>linux</a> #<a href=https://nopointers.work/tags/virtualization/>virtualization</a> #<a href=https://nopointers.work/tags/vmware/>vmware</a> #<a href=https://nopointers.work/tags/secure-boot/>secure boot</a> #<a href=https://nopointers.work/tags/uefi/>uefi</a> #<a href=https://nopointers.work/tags/security/>security</a> #<a href=https://nopointers.work/tags/windows/>windows</a> #<a href=https://nopointers.work/tags/vmware/>vmware</a> </span><h2 id=the-prologue>The prologue</h2><p>Recently I moved to backed to Windows 11, due to my curiosity of state of the things (the grass if always greener on the neighbour’s side I guess 🙄) and because I started working on some game decompilation stuff and using Wine for it is not as comfortable as I would like it to be.<p>Still, I do have plans (and all my backups actually from my Arch installations) to do several small projects for Linux, one of which is a Arch Linux ALPM hook manager application using <a href=https://dotnet.microsoft.com/en-us/apps/maui rel=noopener target=_blank>MAUI and C#</a>. (Yes, C# has been open source and cross-platform since .NET Core. It is even usable since .NET 6.) I got into writing my own hooks and realized that basically there is no good guide on how to put them together, but they are ridicoulosly powerful things. One of the ideas I have learnt from MacOS (yes, more on that later, because I started doing dev stuff there as well), is that you can utilize flowchart based GUI applications to kinda drag and drop very complex automation together.<p>This might sound bad for a seasoned programmer (and I do prefer just scripting things or writing my SystemD service files for it), but looking into it deeper, most non-software-engineer people working with computers prefer the visual method. Think about complex tools like <a title="the Node-RED website" href=https://nodered.org/ rel=noopener target=_blank>Node-RED</a>, <a title="the LabVIEW website" href=https://www.ni.com/en/shop/labview.html rel=noopener target=_blank>LabVIEW</a> or one of the software I was developing when working at Evosoft: <a title="a tool for everything engineering" href=https://www.siemens.com/global/en/products/automation/industry-software/automation-software/tia-portal.html rel=noopener target=_blank>TIA Portal</a>.<p>Long story short, I wanted to find a good performance VM to develop my app, and while WSL <a href=https://learn.microsoft.com/en-us/windows/wsl/tutorials/gui-apps rel=noopener target=_blank>does support GUI apps</a>, I was not sure if I could relaiably debug them or if I would run into problems, which only exist because of WSL. I plan to make a post about the process of trying out other virtualization platforms avaiable on Windows and which ones had what kind of problems.<p>Of course the first thing I do is that I try to install the latest Ubuntu LTS for reference, as it is the most likely to play well on anything and everything.<h2 id=getting-vmware-workstation-pro>Getting VMWare Workstation Pro</h2><p>According to my tests, the easiest and best experience on Windows 11 was using VMWare’s virtualization technology.<p>Recently, <a href=https://investors.broadcom.com/news-releases/news-release-details/broadcom-completes-acquisition-vmware rel=noopener target=_blank>VMWare was bought by Broadcom</a>. For us, developers, this means two things:<ul><li>you will have to create a Broadcom account to download VMWare software,<li>and by extension, seems like VMWare now can afford to offer Workstation Pro (17 or newer for Windows/Linux) and Fusion Pro (13 or newer for MacOS) to be freely used by individuals, yipee!</ul><p>I do know that some folks concerned with their privacy will not be happy about Broadcom tracking their software downloads and usage, but at least we can get the very best legally, for free.<p>One thing to note is that they seemingly forgot to update their download infrastructure and links or most search engines do not show the correct pages. The <a href=https://www.vmware.com/info/workstation-player/evaluation rel=noopener target=_blank>evaluation download website</a> seems to be up and running, but clicking on the download link under <em>Try Workstation 17 Player for Windows</em> (or the Linux link), will result in a Cloudflare error of 522, which is thrown when the host bridged by Cloudflare is down.<p>A good guide was written by <a href=https://www.mikeroysoft.com/post/download-fusion-ws/ rel=noopener target=_blank>Mike Roy</a>, if you want to follow that. Basically you have to register on Broadcom’s website and use their download portal there do get the installer.<h2 id=creating-the-vm-correctly>Creating the VM correctly</h2><p><strong>Note: This applies to 17.5.2 build-23775571 on Windows 11. You might have a (slightly) different experience based on the build and platform used.</strong><p>Now, by default if you download the Ubuntu Desktop installer, VMWare will autodetect it being a Linux distribution.<p>We have to select UEFI under the VM’s settings in the <em>Options</em> tab under <em>Advanced > Firmware type</em>. There is an ominous message about chaning the firmware interface making the VM unbootable. This is kind of true. When the OS installer installs the OS, it configures the bootloader in a way that is conforms to IBM’s BIOS heresay “standards” or the new UEFI specs. Technically you could convert any system to another (except newer Windows versions, because Windows’ <em>bootmgr.efi</em> (the loader for the Windows kernel) only supports UEFI).<p>Because of the aforementioned reason you should only start the OS installation after this is changed to UEFI. Either decline starting the installation image when prompted at the end of the configuration or do not set any to begin with.<p>When selecting Windows 10 or newer installation image, a software TPM is created by the hypervisor for that specific virtual machine. It seems like, it is a requirement for the VMware hypervisor to create one and set it to enable the secure boot option in the previously mentioned <em>Firmware type</em> settings section. Logically, secure boot is a UEFI feature, so it is only available there.<p>There actually are similar attempts at making a similar functionality for non-UEFI systems, but they fail miserably in some way or are really inflexible. I have a Fujitsu based server ran for Nextcloud which has a feature like this, I will write about it in an other post as for it’s age that workstation is very capable actually!<p>Creating a TPM manually can be done after the creation of the VM in the <em>Options</em> tab under <em>Access Control</em>. Not a very descriptive name, but it is basically a mandatory step to create the TPM, as it encrypts the virtual firmware as needed.<p>However, this is only available if the guest OS is set to Windows 10 or newer. So set it to that and you will be able to enable secure boot. It is really important to set these <strong>before</strong> installing the OS, as unless you are doing it manually in Arch for instance, the installer will assume that there is no secure boot/TPM/UEFI firmware, depending on which you have missed. In my tests, it works as intended and reliably. Compared to real hardware, I did not even get the annoying <a href=https://superuser.com/questions/1404738/tpm-2-0-hardware-error-da-lockout-mode rel=noopener target=_blank>TPM DA Lockout mode error</a> from the Ubuntu installer (which is just an inconvenience actually, as it can be <a href=https://ubuntu.com/core/docs/troubleshooting#heading--tpm-lockout rel=noopener target=_blank>easily fixed</a>).<h2 id=vmware-has-bugs-and-is-wrong-about-things>VMware has bugs and is wrong about things</h2><p>Why do I say that? Well, for one, most Linux distributions support secure boot. To be more precise they are compatible with it and MOK system works well, but initramfs attacks are not secured against (unless you use <a href=https://uapi-group.org/specifications/specs/unified_kernel_image/ rel=noopener target=_blank>unified kernel images</a>, which is one executable launched by the firmware, which can be signed and checked against). But every distro you could think of supports UEFI nowadays through <a href=https://www.gnu.org/software/grub/ rel=noopener target=_blank>GRUB</a>/<a href=https://systemd.io/BOOT/ rel=noopener target=_blank>systemd-boot</a> and you can even boot the kernel directly through <a href=https://wiki.archlinux.org/title/EFISTUB rel=noopener target=_blank>EFISTUB</a>!<p>So VMware setting the firmware type to BIOS for linux guests is utter nonsense and is probably a bad piece of unrefactored code left in their codebase to be honest.<p>Also, if you set the guest OS type to Windows, save the settings and try setting it to a Linux variant, you will run into the error message: <em>This VM is ‘UEFI’ enabled, but you are trying to set the VM as a Guest OS that does not support ‘UEFI’. Discard your changes or use a valid Guest OS Version.</em><p>Well duh, this is nonsense. What is more - even though it does defult to BIOS -, you can set UEFI as the firmware platform even for Linux guests after the creation of the VM. Maybe I will try to make a bug report for these things.<h2 id=addendum>Addendum</h2><p>Did you guys enjoy this post? Did you manage to learn something useful? I am looking for any and all feedback and ideas, please hit me up on any of the contacts by clicking the contact page or the social icons at the bottom of the page.<p>See you in the next post! <img alt="GIF of a cat waving bye bye" src=https://tenor.com/view/peach-and-goma-gif-1151492026803486934><nav><div></div><div><a href=https://nopointers.work/linux-security-01/> Creating a (sensibly) secure Linux system for everything. ›</a></div></nav></article></main><footer><hr><div class=c><nav><div><a title="nopointers.work.blog Atom/RSS Feed" href=https://nopointers.work/atom.xml target=_blank type=application/atom+xml><i class="svg rss" title="nopointers.work.blog Atom/RSS Feed" type=Button></i></a><a class="js m-protected" href="#cGF1bGpvdXNlckBwcm90b25tYWlsLmNvbQ==" target=_blank title=Mail><i class="svg mail" title=Mail type=Button></i></a><a href=https://www.facebook.com/balazs.borcsok.39/ target=_blank title=Facebook><i class="svg facebook" title=Facebook type=Button></i></a><a href=https://www.linkedin.com/in/balazs-borcsok-ptr/ target=_blank title=LinkedIn><i class="svg linkedin" title=LinkedIn type=Button></i></a><a href=https://github.com/IPlayZed/ target=_blank title=Github><i class="svg github" title=Github type=Button></i></a><a href=https://stackoverflow.com/users/10653163/ target=_blank title=Stack><i class="svg stack" title=Stack type=Button></i></a></div></nav><p class=s90>© <span id=year>2024</span> nopointers.work.blog • Website content is licensed the <a href=https://www.gnu.org/licenses/agpl-3.0.en.html rel=noopener target=_blank>GNU Affero General Public License</a>.<nav><a class=s90 href=https://nopointers.work/about/> About </a><a class=s90 href=https://nopointers.work/contact/> Contact </a><a class=s90 href=https://nopointers.work/privacy/> Privacy </a><a class=s90 href=https://nopointers.work/sitemap.xml target=_blank> Sitemap </a></nav><p class=s90>Powered by <a href=https://www.getzola.org/ target=_blank>Zola</a> & <a href=https://github.com/Jieiku/abridge/ target=_blank>Abridge</a> & <a = href=https://pages.github.com/ target=_blank> Github Pages</a></div></footer><span class=topout> <span class=topleft> </span><a title="Back to Top" class=top href=#><i class="svgs svgh angu"></i></a> </span>